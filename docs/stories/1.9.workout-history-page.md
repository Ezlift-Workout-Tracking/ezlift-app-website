# Story 1.9: Workout History Page

## Status
Draft

## Story
**As a** user,  
**I want** to browse my past workouts with pagination and filtering,  
**so that** I can review training history.

## Acceptance Criteria
1. List view: `GET /workout-log` (all sessions, client-side pagination for 20 per page)
2. Each item shows: Date, workout title, duration, exercises (count), sets (count)
3. Date range filter (last 7 days, 30 days, 90 days, all time)
4. Pagination controls (previous, next, page numbers)
5. Click workout â†’ Open detail modal
6. Empty state: "No workouts yet" with CTAs "Import History" or "Download Mobile App"
7. Skeleton loading state while fetching
8. URL state: `?page=2&range=30days`
9. Analytics: "History Viewed" (workoutCount: number), "History Filtered", "History Paginated"

## Integration Verification
- IV1: Pagination works correctly (total count, page calculations)
- IV2: Filters update URL without full page reload
- IV3: Works with large datasets (100+ sessions)

## Tasks / Subtasks

### Task 1: Create History Page Component (AC: 1, 2, 8)
- [ ] Create `app/app/history/page.tsx`
  - [ ] Implement server component for initial data fetch
  - [ ] Read pagination from URL: `?page=2&range=30days`
  - [ ] Pass to client component
- [ ] Create `components/history/WorkoutHistoryList.tsx` (client component)
  - [ ] Use React Query for data fetching
  - [ ] Query key includes page and filter params
  - [ ] Display list of 20 workouts per page
  - [ ] Handle loading, error, and empty states

### Task 2: Create Workout List Item Component (AC: 2)
- [ ] Create `components/history/WorkoutHistoryItem.tsx`
  - [ ] Display relative date: "Today", "Yesterday", "3 days ago", or "Jan 5"
  - [ ] Display workout title or program name
  - [ ] Display duration: "1h 15min"
  - [ ] Display exercise count: "8 exercises"
  - [ ] Display set count: "24 sets"
  - [ ] Add hover state (light gray background)
  - [ ] Make clickable (cursor pointer)

### Task 3: Implement Date Range Filter (AC: 3, IV2)
- [ ] Create `components/history/HistoryFilters.tsx`
  - [ ] Date range selector: Last 7 days, 30 days, 90 days, All time
  - [ ] Use shadcn/ui Tabs or Select component
  - [ ] Update URL query param on filter change
  - [ ] Use Next.js router for URL updates (no page reload)
  - [ ] Filter value syncs with URL on page load

### Task 4: Implement Pagination (AC: 4, IV1)
- [ ] Create pagination component
  - [ ] Use shadcn/ui Pagination component
  - [ ] Display: Previous, page numbers, Next
  - [ ] Calculate total pages from total count
  - [ ] Update URL query param on page change
  - [ ] Scroll to top on page change
  - [ ] Disable previous on page 1, disable next on last page

### Task 5: Implement Workout Click Interaction (AC: 5)
- [ ] Add click handler to workout items
  - [ ] Fire analytics event
  - [ ] Open workout detail modal (create modal component)
  - [ ] Fetch workout details: `GET /api/logs/{id}`
  - [ ] Display: All exercises, sets, weights, reps, rest times
  - [ ] Close modal button

### Task 6: Implement Empty State (AC: 6)
- [ ] Create `components/history/HistoryEmptyState.tsx`
  - [ ] Check user data state (new vs existing)
  - [ ] New user: "No workouts yet" with CTAs
  - [ ] CTAs: "Import History" and "Download Mobile App"
  - [ ] Icon: Calendar or clipboard
  - [ ] Centered layout

### Task 7: Implement Loading State (AC: 7)
- [ ] Create skeleton loader for history list
  - [ ] Show 20 skeleton items while fetching
  - [ ] Match workout item dimensions
  - [ ] Animate with pulse effect

### Task 8: Integrate Analytics (AC: 9)
- [ ] Add "History Viewed" on page mount
  - [ ] Properties: `workoutCount: number`, `dateRange: string`, `page: number`
- [ ] Add "History Filtered" on filter change
  - [ ] Properties: `previousRange: string`, `newRange: string`
- [ ] Add "History Paginated" on page change
  - [ ] Properties: `previousPage: number`, `newPage: number`
- [ ] Add "History Workout Clicked" on item click
  - [ ] Properties: `workoutId: string`, `workoutDate: string`

### Task 9: Testing
- [ ] Write unit tests for pagination logic
  - [ ] Test: Calculate total pages correctly
  - [ ] Test: Page number boundaries (first/last)
  - [ ] Test: URL param parsing
- [ ] Write unit tests for filter logic
  - [ ] Test: Date range calculations
  - [ ] Test: URL param updates
- [ ] Write integration tests for page
  - [ ] Test: List renders with workouts
  - [ ] Test: Pagination controls work
  - [ ] Test: Filter changes update list
  - [ ] Test: URL state persists
  - [ ] Test: Empty state displays
  - [ ] Test: Workout click opens modal
  - [ ] Test: Analytics events fire

## Dev Notes

### ğŸ”§ Developer Setup Reference
**Development Prerequisites**: Complete Stories 1.1-1.8 (especially 1.1-1.4)
- **Setup Guide**: `docs/DEVELOPER_SETUP.md`
- **Dependencies**: React Query, shadcn/ui components
- **Branch**: `feature/story-1.9-workout-history-page`

**Source**: [DEVELOPER_SETUP.md]

### ğŸ“ User Flow & Wireframe References
**User Flow**: Workout History provides paginated access to all training sessions
- **Flow Reference**: `docs/web-app-user-flows.md` - Section "Navigation & Available Actions" (History)
- **Wireframe Note**: Full history page wireframe not in wireframes.md - implement based on AC and standard list patterns

**Key UX Requirements**:
- Paginated list (20 per page) for performance
- Date range filtering for focused views
- Click to view workout details
- Empty state varies by user type
- URL state for sharing and navigation

**Navigation**:
- Access from: Dashboard nav ("History"), Recent Workouts card ("View History â†’")
- URL: `/app/history?page=1&range=30days`

**Source**: [web-app-user-flows.md - Navigation & Available Actions]

### ğŸ¨ Wireframe for Implementation

#### Workout History Page (Desktop)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Logo]  Dashboard  Programs  History  Import              [Avatar â–¾]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Workout History                      [Filter: Last 30 Days â–¾]              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“… Today, 9:30 AM                                        [View â†’]      â”‚ â”‚
â”‚  â”‚  Push Day - Week 4                                                     â”‚ â”‚
â”‚  â”‚  1h 15min â€¢ 8 exercises â€¢ 24 sets                                      â”‚ â”‚
â”‚  â”‚  ğŸ’ª Chest, Shoulders, Triceps                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“… Yesterday                                             [View â†’]      â”‚ â”‚
â”‚  â”‚  Pull Day - Week 4                                                     â”‚ â”‚
â”‚  â”‚  1h 05min â€¢ 7 exercises â€¢ 21 sets                                      â”‚ â”‚
â”‚  â”‚  ğŸ’ª Back, Biceps                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“… 3 days ago                                            [View â†’]      â”‚ â”‚
â”‚  â”‚  Leg Day - Week 3                                                      â”‚ â”‚
â”‚  â”‚  1h 30min â€¢ 6 exercises â€¢ 20 sets                                      â”‚ â”‚
â”‚  â”‚  ğŸ’ª Legs, Glutes                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  ... (17 more items) ...                                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [â† Previous]    1  2  3  4  5  ... 12                  [Next â†’]       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  Showing 1-20 of 234 workouts                                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Page Specs**:
- Page heading: "Workout History" (32px, bold)
- Filter: Top-right, date range selector
- Workout items: Full-width cards, 80px height
- Gap between items: 12px
- Pagination: Bottom, centered, 40px height

**Workout Item Specs**:
- Padding: 16px
- Background: White
- Border: 1px solid gray, rounded 8px
- Hover: Light gray background, shadow increase
- Date: 14px, bold, dark gray
- Title: 16px, regular, dark gray
- Meta: 14px, light gray (duration, exercises, sets)
- Muscle groups: 12px, light gray with icon

**Pagination Specs**:
- Previous/Next: Buttons, 40px height
- Page numbers: Clickable, active page highlighted blue
- Show 5 page numbers max, with ellipsis for more
- Total count: "Showing X-Y of Z workouts" (12px, gray)

**Empty State**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Logo]  Dashboard  Programs  History  Import              [Avatar â–¾]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Workout History                                                             â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚                               ğŸ“‹                                             â”‚
â”‚                                                                              â”‚
â”‚                         No workouts yet                                      â”‚
â”‚                                                                              â”‚
â”‚                  Track your first workout on mobile                          â”‚
â”‚                     or import your history from another app                  â”‚
â”‚                                                                              â”‚
â”‚              [Download Mobile App]    [Import History]                       â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Mobile Layout** (375px width):
- Items stack vertically
- Pagination simplified: "â† Previous" | "1 of 12" | "Next â†’"
- Filter moves to top, full-width dropdown
- Each item: 100px height (more vertical space for readability)

**Source**: [Epic 1.9 AC, web-app-user-flows.md - Navigation]

### API Integration
**Session List with Pagination**:
```
GET /workout-log (all sessions, client-side pagination and filtering)

Response: {
  sessions: WorkoutSession[]; // All sessions, client-side pagination required
  limit: number;
  pages: number;
}
```

**Pagination Calculation**:
```typescript
const totalPages = Math.ceil(total / limit);
const currentPage = Math.min(page, totalPages);
const hasNext = currentPage < totalPages;
const hasPrevious = currentPage > 1;
```

**Source**: [API Integration (MVP) - Workout Session (Log) Endpoints]

### URL State Management
**Query Parameters**:
- `page`: Current page number (default: 1)
- `range`: Date range filter (default: '30days')

**Implementation**:
```typescript
// app/app/history/page.tsx
import { useRouter, useSearchParams } from 'next/navigation';

export function WorkoutHistoryPage() {
  const router = useRouter();
  const searchParams = useSearchParams();
  
  const page = parseInt(searchParams.get('page') || '1');
  const range = searchParams.get('range') || '30days';
  
  const updateURL = (newPage: number, newRange?: string) => {
    const params = new URLSearchParams();
    params.set('page', newPage.toString());
    params.set('range', newRange || range);
    
    router.push(`/app/history?${params.toString()}`);
  };
  
  // ...
}
```

**Source**: [System Architecture (MVP) - Key Architectural Patterns, Component Architecture]

### Workout Detail Modal
**Future Enhancement** (AC 5):
```typescript
// components/history/WorkoutDetailModal.tsx
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';

export function WorkoutDetailModal({ 
  workoutId, 
  isOpen, 
  onClose 
}: WorkoutDetailModalProps) {
  const { data: workout, isLoading } = useQuery({
    queryKey: ['workouts', workoutId],
    queryFn: () => fetchWorkoutById(workoutId),
    enabled: isOpen  // Only fetch when modal open
  });
  
  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-2xl max-h-[80vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>
            {workout?.title || 'Workout Details'} - {formatDate(workout?.sessionDate)}
          </DialogTitle>
        </DialogHeader>
        
        {isLoading ? (
          <WorkoutDetailSkeleton />
        ) : (
          <div className="space-y-4">
            <div className="text-sm text-gray-600">
              Duration: {formatDuration(workout.duration)} â€¢ 
              {workout.logs?.length || 0} exercises â€¢ 
              {calculateTotalSets(workout)} sets
            </div>
            
            {workout.logs?.map((log, idx) => (
              <div key={idx} className="border-t pt-4">
                <h4 className="font-semibold">{idx + 1}. {log.exerciseName}</h4>
                <div className="mt-2 space-y-1">
                  {log.sets?.map((set, setIdx) => (
                    <div key={setIdx} className="text-sm text-gray-700">
                      Set {set.setNumber}: {set.weight} kg Ã— {set.reps} reps
                      {set.restTime && ` â€¢ ${set.restTime}s rest`}
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        )}
      </DialogContent>
    </Dialog>
  );
}
```

**Source**: [Component Architecture - History Components]

### Task 10: Create Pagination Component (AC: 4, IV1)
- [ ] Implement pagination controls
  - [ ] Use shadcn/ui Pagination component
  - [ ] Calculate total pages from API response
  - [ ] Display page numbers (show max 5, with ellipsis)
  - [ ] Previous/Next buttons
  - [ ] Update URL on page change
  - [ ] Scroll to top after page change
  - [ ] Test edge cases: page 1, last page, invalid page numbers

### Task 11: Implement Loading State (AC: 7)
- [ ] Create skeleton loader
  - [ ] Show 20 skeleton items
  - [ ] Match workout item height (80px)
  - [ ] Pulse animation
  - [ ] Display while `isLoading === true`

### Task 12: Implement Empty State (AC: 6)
- [ ] Create empty state component
  - [ ] Icon: Calendar or clipboard
  - [ ] Message: "No workouts yet"
  - [ ] Subtext: "Track your first workout on mobile or import your history"
  - [ ] CTAs: "Download Mobile App" and "Import History"
  - [ ] Centered layout

### Task 13: Integrate Analytics (AC: 9)
- [ ] Add "History Viewed" on page mount
  - [ ] Properties: `workoutCount: number`, `dateRange: string`, `page: number`
- [ ] Add "History Filtered" on filter change
  - [ ] Properties: `previousRange: string`, `newRange: string`
- [ ] Add "History Paginated" on page change
  - [ ] Properties: `previousPage: number`, `newPage: number`, `totalPages: number`
- [ ] Add "History Workout Clicked" on workout click
  - [ ] Properties: `workoutId: string`, `workoutDate: string`

### Task 14: Testing
- [ ] Write unit tests for pagination
  - [ ] Test: Calculate total pages
  - [ ] Test: Page boundaries (1, last)
  - [ ] Test: Invalid page numbers
- [ ] Write unit tests for filtering
  - [ ] Test: Date range calculations
  - [ ] Test: URL param updates
- [ ] Write integration tests for page
  - [ ] Test: List renders with workouts
  - [ ] Test: Pagination works (click next, prev)
  - [ ] Test: Filter updates list
  - [ ] Test: URL state persists across reload
  - [ ] Test: Workout click opens modal
  - [ ] Test: Modal displays workout details
  - [ ] Test: Empty state shows
  - [ ] Test: Loading skeleton displays

## Dev Notes

### ğŸ”§ Developer Setup Reference
**Development Prerequisites**: Complete Stories 1.1-1.8
- **Setup Guide**: `docs/DEVELOPER_SETUP.md`
- **Dependencies**: shadcn/ui Pagination, Dialog components
- **Branch**: `feature/story-1.9-workout-history-page`

**Source**: [DEVELOPER_SETUP.md]

### ğŸ“ User Flow & Wireframe References
**User Flow**: History page provides comprehensive view of all training sessions
- **Flow Reference**: `docs/web-app-user-flows.md` - Section "Navigation & Available Actions" (History)
- **Wireframe Note**: Full-page wireframe defined in story (based on AC and UX patterns)

**Key UX Requirements**:
- Accessible from Dashboard nav and Recent Workouts card
- Paginated for performance (20 per page)
- Filterable by date range
- Clickable items show full workout details
- Empty state with clear CTAs

**Source**: [web-app-user-flows.md - Navigation]

### Component Implementation
```typescript
// app/app/history/page.tsx
import { WorkoutHistoryClient } from '@/components/history/WorkoutHistoryClient';

export default async function HistoryPage({ 
  searchParams 
}: { 
  searchParams: { page?: string; range?: string } 
}) {
  const page = parseInt(searchParams.page || '1');
  const range = searchParams.range || '30days';
  
  // Initial server-side fetch (optional - can be client-only)
  const initialData = await fetchWorkouts({ page, range });
  
  return (
    <div className="container mx-auto py-8">
      <WorkoutHistoryClient 
        initialData={initialData}
        initialPage={page}
        initialRange={range}
      />
    </div>
  );
}
```

**Client Component**:
```typescript
// components/history/WorkoutHistoryClient.tsx
'use client';

export function WorkoutHistoryClient({ 
  initialData, 
  initialPage, 
  initialRange 
}: Props) {
  const router = useRouter();
  const [page, setPage] = useState(initialPage);
  const [range, setRange] = useState(initialRange);
  const [selectedWorkout, setSelectedWorkout] = useState<string | null>(null);
  
  const { startDate, endDate } = useDateRangeFromFilter(range);
  
  const { data, isLoading } = useQuery({
    queryKey: ['workouts', 'list', page, range],
    queryFn: () => fetchWorkouts({ page, range: { startDate, endDate }, limit: 20 }),
    initialData,
    keepPreviousData: true  // Smooth page transitions
  });
  
  const handlePageChange = (newPage: number) => {
    setPage(newPage);
    updateURL(newPage, range);
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    analytics.track('History Paginated', {
      previousPage: page,
      newPage,
      totalPages: data?.pages
    });
  };
  
  const handleFilterChange = (newRange: string) => {
    setRange(newRange);
    setPage(1);  // Reset to page 1 on filter change
    updateURL(1, newRange);
    
    analytics.track('History Filtered', {
      previousRange: range,
      newRange
    });
  };
  
  const handleWorkoutClick = (workoutId: string) => {
    setSelectedWorkout(workoutId);
    
    analytics.track('History Workout Clicked', {
      workoutId,
      page,
      range
    });
  };
  
  useEffect(() => {
    analytics.track('History Viewed', {
      workoutCount: data?.total || 0,
      dateRange: range,
      page
    });
  }, []);
  
  if (isLoading) {
    return <WorkoutHistorySkeleton />;
  }
  
  if (!data || data.sessions.length === 0) {
    return <HistoryEmptyState />;
  }
  
  return (
    <>
      <div className="mb-6 flex justify-between items-center">
        <h1 className="text-3xl font-bold">Workout History</h1>
        <HistoryFilters value={range} onChange={handleFilterChange} />
      </div>
      
      <div className="space-y-3">
        {data.sessions.map(session => (
          <WorkoutHistoryItem
            key={session.id}
            session={session}
            onClick={() => handleWorkoutClick(session.id)}
          />
        ))}
      </div>
      
      <Pagination
        currentPage={page}
        totalPages={data.pages}
        onPageChange={handlePageChange}
      />
      
      <p className="text-sm text-gray-600 mt-4 text-center">
        Showing {(page - 1) * 20 + 1}-{Math.min(page * 20, data.total)} of {data.total} workouts
      </p>
      
      <WorkoutDetailModal
        workoutId={selectedWorkout}
        isOpen={selectedWorkout !== null}
        onClose={() => setSelectedWorkout(null)}
      />
    </>
  );
}
```

**Source**: [Component Architecture - History Components, State Management]

### Pagination Best Practices
**Page Limit**: 20 items per page (balance between scrolling and loading)

**URL State Benefits**:
- Shareable links: Users can bookmark specific pages
- Browser back/forward: Works as expected
- Refresh: Returns to same page and filter

**Performance**:
- Use `keepPreviousData: true` in React Query for smooth transitions
- Prefetch next page on hover (optional enhancement)
- Cache pages for fast back navigation

**Source**: [Performance Strategy - Optimization Techniques]

### Testing Requirements

**Unit Tests** (Jest):
- Pagination calculations
- Date range filter logic
- URL parameter parsing and updates

**Integration Tests** (Testing Library + MSW):
- History list renders
- Pagination navigation works
- Filter changes update list
- URL state persists
- Workout click opens modal
- Modal displays correct data
- Empty state displays
- Analytics events fire

**E2E Tests** (Optional):
- Navigate to history from dashboard
- Filter workouts by date
- Page through workout list
- Click workout to view details
- Close modal and list remains on same page

**Test File Locations**:
- `__tests__/components/history/WorkoutHistoryList.test.tsx`
- `__tests__/components/history/WorkoutHistoryItem.test.tsx`
- `__tests__/components/history/WorkoutDetailModal.test.tsx`
- `__tests__/pages/history.test.tsx`

**Source**: [Testing Strategy - Unit Tests, Integration Tests]

### Performance Considerations
**Large Datasets** (IV3):
- Test with 100+ workouts
- Pagination prevents loading all at once
- Page size (20) optimized for scroll depth
- Lazy load workout details only when modal opened

**Target Performance**:
- Page load: < 300ms (20 workouts)
- Page change: < 200ms (cached or prefetched)
- Filter change: < 300ms (new query)

**Source**: [Performance Strategy - Performance Budgets]

## Testing

### Test Coverage Requirements
- Unit test coverage: > 85% for pagination and filtering logic
- Integration test coverage: All page states and interactions

### Test Scenarios
1. **Page Load**: Navigate to /app/history â†’ List displays
2. **Pagination**: Click "Next" â†’ Page 2 loads, URL updates
3. **Filter**: Change range to "Last 7 Days" â†’ List updates, URL updates
4. **URL State**: Load /app/history?page=3&range=90days â†’ Correct page and filter applied
5. **Workout Click**: Click workout â†’ Modal opens with details
6. **Empty State**: New user, no workouts â†’ Empty state with CTAs
7. **Loading**: Navigate to page â†’ Skeleton displays, then list
8. **Large Dataset**: 100+ workouts â†’ Pagination handles correctly

### Performance Targets
- Page load (20 items): < 300ms
- Page change: < 200ms
- Filter change: < 300ms
- Modal open: < 200ms

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Initial story creation with complete references | Bob (SM) |

## Dev Agent Record
*(To be populated by dev agent during implementation)*

### Agent Model Used
*(To be filled by dev agent)*

### Debug Log References
*(To be filled by dev agent)*

### Completion Notes List
*(To be filled by dev agent)*

### File List
*(To be filled by dev agent)*

### ğŸ”´ CRITICAL: API Endpoint Correction
**URGENT: Backend API uses `/workout-log` endpoint, not `/api/logs`**

- **Problem**: Stories were originally documented with incorrect `/api/logs` endpoint
- **Solution**: All API routes and implementations MUST use `/workout-log` endpoint
- **Impact**: Stories 1.2, 1.4, 1.5, 1.6, 1.7, 1.9, 1.10 need to be redone to use correct endpoint
- **Files to Update**:
  - `app/api/workout-log/route.ts` (create/rename from logs)
  - All fetch calls must use `/workout-log` instead of `/api/logs`
  - Update tests to mock correct endpoint

## QA Results
*(To be populated by QA agent after dev completion)*



