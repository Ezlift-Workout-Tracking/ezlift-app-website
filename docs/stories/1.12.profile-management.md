# Story 1.12: Profile Management

## Status
Draft

## Story
**As a** user,  
**I want** to view and edit my profile settings,  
**so that** my units and measurements are correct.

## Acceptance Criteria
1. Display: Name, email (read-only), units, bodyweight
2. Editable fields: Weight unit (kg/lbs), distance unit (km/mi), height unit (cm/in), bodyweight
3. Save button: `PATCH /api/user` with optimistic update
4. Success toast: "Profile updated!"
5. Error handling: Rollback optimistic update, show error toast
6. Changes reflect immediately in dashboard (volume calculations use correct units)
7. Analytics: "Profile Viewed", "Profile Updated" (fields: string[])

## Integration Verification
- IV1: Optimistic update provides instant feedback
- IV2: Rollback works on error (UI reverts to previous values)
- IV3: Unit changes affect dashboard calculations correctly

## Tasks / Subtasks

### Task 1: Create Profile Page (AC: 1, 2)
- [ ] Create `app/app/profile/page.tsx`
  - [ ] Fetch user profile: `useQuery(['user', 'profile'])`
  - [ ] Display form with current values
  - [ ] Read-only fields: Name, email
  - [ ] Editable fields: Units (weight, distance, height), bodyweight
- [ ] Create `components/profile/ProfileForm.tsx`
  - [ ] Form with controlled inputs
  - [ ] Unit selectors (dropdown or radio buttons)
  - [ ] Bodyweight input (number, with unit)
  - [ ] Save and Cancel buttons

### Task 2: Implement Optimistic Update (AC: 3, IV1, IV2)
- [ ] Create `lib/mutations/update-profile.ts`
  - [ ] Implement `useUpdateProfile()` mutation hook
  - [ ] PATCH /api/user endpoint
  - [ ] Optimistic update: Update cache before API responds
  - [ ] Rollback on error: Restore previous values
  - [ ] Invalidate cache on success
- [ ] Test optimistic update behavior
  - [ ] Change value â†’ UI updates instantly
  - [ ] Simulate error â†’ UI reverts to original value
  - [ ] Success â†’ UI keeps new value

### Task 3: Implement Form Validation (AC: 2)
- [ ] Add client-side validation
  - [ ] Bodyweight: Positive number, reasonable range (30-300 kg/lbs)
  - [ ] Units: Must select valid option
  - [ ] Disable save button if invalid
- [ ] Show validation errors inline
  - [ ] Below field with error message
  - [ ] Red border on invalid field

### Task 4: Implement Success/Error Handling (AC: 4, 5)
- [ ] Add success toast on save
  - [ ] Message: "Profile updated!"
  - [ ] Duration: 3 seconds
  - [ ] Auto-dismiss
- [ ] Add error toast on failure
  - [ ] Message: "Failed to update profile. Please try again."
  - [ ] Action: Retry button
  - [ ] Log error to console

### Task 5: Verify Dashboard Integration (AC: 6, IV3)
- [ ] Test unit conversion in dashboard
  - [ ] Change weight unit kg â†’ lbs
  - [ ] Verify dashboard volume calculations update
  - [ ] Verify chart labels update (kg â†’ lbs)
- [ ] Test React Query cache invalidation
  - [ ] Update profile â†’ Cache invalidated
  - [ ] Dashboard refetches with new units

### Task 6: Integrate Analytics (AC: 7)
- [ ] Add "Profile Viewed" on page mount
  - [ ] Properties: `userId: string`, `hasCompletedProfile: boolean`
- [ ] Add "Profile Updated" on save success
  - [ ] Properties: `fields: string[]` (which fields changed), `weightUnit: string`, `distanceUnit: string`

### Task 7: Testing
- [ ] Write unit tests for form validation
  - [ ] Test: Valid bodyweight accepted
  - [ ] Test: Invalid bodyweight rejected (< 0, > 500)
  - [ ] Test: Unit selection validation
- [ ] Write unit tests for optimistic update
  - [ ] Test: Update cache immediately
  - [ ] Test: Rollback on error
  - [ ] Test: Invalidate on success
- [ ] Write integration tests for profile page
  - [ ] Test: Form displays current values
  - [ ] Test: Edit and save updates profile
  - [ ] Test: Success toast shows
  - [ ] Test: Error handling and rollback
  - [ ] Test: Dashboard reflects unit changes
  - [ ] Test: Analytics events fire

## Dev Notes

### ğŸ”§ Developer Setup Reference
**Development Prerequisites**: Complete Stories 1.1-1.8
- **Setup Guide**: `docs/DEVELOPER_SETUP.md`
- **Dependencies**: React Query, shadcn/ui form components
- **Branch**: `feature/story-1.12-profile-management`

**Source**: [DEVELOPER_SETUP.md]

### ğŸ“ User Flow & Wireframe References
**User Flow**: Profile page accessed from navigation or avatar dropdown
- **Flow Reference**: `docs/web-app-user-flows.md` - Section "Navigation & Available Actions" (Settings/Profile)
- **Wireframe Note**: Profile page wireframe not detailed in wireframes.md - implement based on AC and standard form patterns

**Key UX Requirements**:
- Simple form with current values pre-filled
- Instant feedback via optimistic updates
- Clear success/error messaging
- Unit changes affect dashboard immediately

**Navigation**:
- Access from: Top nav ("Profile"), Avatar dropdown menu
- URL: `/app/profile`

**Source**: [web-app-user-flows.md - Navigation]

### ğŸ¨ Wireframe for Implementation

#### Profile Page (Desktop)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Logo]  Dashboard  Programs  History  Import  Profile      [Avatar â–¾]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Profile Settings                                                            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Account Information                                                   â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  Name:          {User Full Name}                       (Read-only)    â”‚ â”‚
â”‚  â”‚  Email:         user@example.com                       (Read-only)    â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Preferences & Units                                                   â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  Weight Unit:         â—‹ Kilograms (kg)  â— Pounds (lbs)                â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  Distance Unit:       â— Kilometers (km)  â—‹ Miles (mi)                 â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  Height Unit:         â— Centimeters (cm)  â—‹ Inches (in)               â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  Current Bodyweight:  [185___] lbs                                    â”‚ â”‚
â”‚  â”‚                       Last updated: 2 days ago                         â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Privacy & Data                                                        â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  [Export My Data]                   [Delete Account]                  â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  [Cancel]                                                   [Save Changes]  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Design Specs**:
- Max-width: 800px, centered
- Card sections: Grouped logically
- Read-only fields: Gray background, no border
- Editable fields: White background, border
- Radio buttons: Horizontal layout for unit selectors
- Bodyweight input: Number input with unit suffix
- Buttons:
  - Cancel: Gray, outline
  - Save Changes: Blue, filled, disabled until changes made

**Mobile Layout** (375px):
- Same sections, stacked
- Radio buttons: Vertical layout
- Buttons: Full-width, stacked
- Form fits in viewport

**Source**: [Epic 1.12 AC, Standard form patterns]

### API Integration
**User Profile Endpoint**:
```
GET /api/user
Response: {
  id: string;
  email: string;
  name: string;
  weightUnit: 'kg' | 'lbs';
  distanceUnit: 'km' | 'mi';
  heightUnit: 'cm' | 'in';
  bodyweight?: number;
  bodyweightUnit: 'kg' | 'lbs';
  updatedAt: string;
}

PATCH /api/user
Body: Partial<UserProfile>
Response: Updated UserProfile
```

**Source**: [API Integration (MVP) - User & Profile Endpoints]

### Optimistic Update Pattern
**Implementation** (from architecture):
```typescript
// lib/mutations/update-profile.ts
import { useMutation, useQueryClient } from '@tanstack/react-query';

export function useUpdateProfile() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: (updates: Partial<UserProfile>) => 
      api.patch('/api/user', updates),
    
    // Optimistic update
    onMutate: async (updates) => {
      // Cancel outgoing refetches
      await queryClient.cancelQueries({ queryKey: ['user', 'profile'] });
      
      // Snapshot previous value
      const previous = queryClient.getQueryData(['user', 'profile']);
      
      // Optimistically update cache
      queryClient.setQueryData(['user', 'profile'], (old: UserProfile) => ({
        ...old,
        ...updates
      }));
      
      // Return rollback context
      return { previous };
    },
    
    // Rollback on error
    onError: (err, variables, context) => {
      if (context?.previous) {
        queryClient.setQueryData(['user', 'profile'], context.previous);
      }
      toast.error('Failed to update profile');
      
      analytics.track('Profile Update Failed', {
        error: err.message
      });
    },
    
    // Success handling
    onSuccess: (data, variables) => {
      queryClient.invalidateQueries({ queryKey: ['user', 'profile'] });
      toast.success('Profile updated!');
      
      // Track which fields changed
      const changedFields = Object.keys(variables);
      analytics.track('Profile Updated', {
        fields: changedFields,
        weightUnit: data.weightUnit,
        distanceUnit: data.distanceUnit
      });
    }
  });
}
```

**Source**: [State Management - Optimistic Updates pattern, Epic 1.12]

### Unit Conversion for Dashboard
**When units change**, dashboard must recalculate:

```typescript
// lib/utils/unit-conversion.ts
export function convertWeight(
  value: number,
  from: 'kg' | 'lbs',
  to: 'kg' | 'lbs'
): number {
  if (from === to) return value;
  
  if (from === 'kg' && to === 'lbs') {
    return value * 2.20462;
  }
  
  if (from === 'lbs' && to === 'kg') {
    return value / 2.20462;
  }
  
  return value;
}

export function formatWeight(value: number, unit: 'kg' | 'lbs'): string {
  return `${value.toFixed(1)} ${unit}`;
}
```

**Dashboard Integration**:
- React Query cache invalidation triggers dashboard refetch
- Dashboard cards use user's current unit preference
- All weight calculations converted to user's unit

**Source**: [Data Architecture (MVP), Epic 1.12 AC 6]

### Form Implementation
```typescript
// components/profile/ProfileForm.tsx
import { useForm } from 'react-hook-form';
import { useUpdateProfile } from '@/lib/mutations/update-profile';

export function ProfileForm({ profile }: { profile: UserProfile }) {
  const { mutate: updateProfile, isLoading } = useUpdateProfile();
  
  const { register, handleSubmit, formState: { isDirty, errors } } = useForm({
    defaultValues: {
      weightUnit: profile.weightUnit,
      distanceUnit: profile.distanceUnit,
      heightUnit: profile.heightUnit,
      bodyweight: profile.bodyweight
    }
  });
  
  const onSubmit = (data) => {
    updateProfile(data);
  };
  
  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      {/* Account Information (Read-only) */}
      <Card>
        <CardHeader>
          <CardTitle>Account Information</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <label className="text-sm font-medium">Name</label>
            <Input value={profile.name} disabled className="bg-gray-50" />
          </div>
          <div>
            <label className="text-sm font-medium">Email</label>
            <Input value={profile.email} disabled className="bg-gray-50" />
          </div>
        </CardContent>
      </Card>
      
      {/* Preferences & Units (Editable) */}
      <Card>
        <CardHeader>
          <CardTitle>Preferences & Units</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <label className="text-sm font-medium mb-2 block">Weight Unit</label>
            <RadioGroup {...register('weightUnit')}>
              <RadioGroupItem value="kg" label="Kilograms (kg)" />
              <RadioGroupItem value="lbs" label="Pounds (lbs)" />
            </RadioGroup>
          </div>
          
          <div>
            <label className="text-sm font-medium mb-2 block">Distance Unit</label>
            <RadioGroup {...register('distanceUnit')}>
              <RadioGroupItem value="km" label="Kilometers (km)" />
              <RadioGroupItem value="mi" label="Miles (mi)" />
            </RadioGroup>
          </div>
          
          <div>
            <label className="text-sm font-medium mb-2 block">Height Unit</label>
            <RadioGroup {...register('heightUnit')}>
              <RadioGroupItem value="cm" label="Centimeters (cm)" />
              <RadioGroupItem value="in" label="Inches (in)" />
            </RadioGroup>
          </div>
          
          <div>
            <label className="text-sm font-medium mb-2 block">Current Bodyweight</label>
            <div className="flex gap-2">
              <Input 
                type="number" 
                {...register('bodyweight', {
                  min: { value: 30, message: 'Bodyweight must be at least 30' },
                  max: { value: 300, message: 'Bodyweight must be less than 300' }
                })}
                placeholder="185"
              />
              <span className="self-center text-gray-600">
                {watch('weightUnit') || 'kg'}
              </span>
            </div>
            {errors.bodyweight && (
              <p className="text-sm text-red-600 mt-1">{errors.bodyweight.message}</p>
            )}
            {profile.updatedAt && (
              <p className="text-xs text-gray-500 mt-1">
                Last updated: {formatRelativeDate(new Date(profile.updatedAt))}
              </p>
            )}
          </div>
        </CardContent>
      </Card>
      
      {/* Actions */}
      <div className="flex justify-end gap-3">
        <Button type="button" variant="outline" onClick={() => router.back()}>
          Cancel
        </Button>
        <Button 
          type="submit" 
          disabled={!isDirty || isLoading}
          isLoading={isLoading}
        >
          Save Changes
        </Button>
      </div>
    </form>
  );
}
```

**Source**: [Component Architecture, State Management - Optimistic Updates]

### Task 8: Integrate Analytics (AC: 7)
- [ ] Add "Profile Viewed" on page mount
- [ ] Add "Profile Updated" on save success
  - [ ] Track which fields changed
  - [ ] Track new unit values

### Task 9: Testing
- [ ] Write unit tests for form validation
  - [ ] Test: Valid inputs accepted
  - [ ] Test: Invalid bodyweight rejected
  - [ ] Test: Save button disabled when pristine
  - [ ] Test: Save button disabled when invalid
- [ ] Write unit tests for optimistic update
  - [ ] Test: Cache updated immediately
  - [ ] Test: Rollback on error
  - [ ] Test: Cache invalidated on success
- [ ] Write integration tests for profile page
  - [ ] Test: Form loads with current values
  - [ ] Test: Edit units â†’ Save â†’ Success toast
  - [ ] Test: Edit bodyweight â†’ Save â†’ Updates profile
  - [ ] Test: Simulated error â†’ Rollback â†’ Error toast
  - [ ] Test: Unit change â†’ Dashboard recalculates
  - [ ] Test: Analytics events fire

## Dev Notes

### ğŸ”§ Developer Setup Reference
**Development Prerequisites**: Complete Stories 1.1-1.8
- **Setup Guide**: `docs/DEVELOPER_SETUP.md`
- **Dependencies**: React Query, react-hook-form (optional)
- **Branch**: `feature/story-1.12-profile-management`

**Source**: [DEVELOPER_SETUP.md]

### ğŸ“ User Flow Reference
**User Flow**: Profile accessible from top navigation and avatar dropdown
- **Flow Reference**: `docs/web-app-user-flows.md` - Navigation section (Profile/Settings)

**Source**: [web-app-user-flows.md]

### User Profile Data Model
**UserProfile Type**:
```typescript
interface UserProfile {
  id: string;
  email: string;
  name: string;
  weightUnit: 'kg' | 'lbs';
  distanceUnit: 'km' | 'mi';
  heightUnit: 'cm' | 'in';
  bodyweight?: number;
  bodyweightUnit: 'kg' | 'lbs';  // Can differ from weightUnit
  height?: number;
  createdAt: string;
  updatedAt: string;
}
```

**Source**: [Data Architecture (MVP), API Integration]

### Unit Conversion Impact
**Dashboard Cards Affected**:
1. Training Volume Card: Weight Ã— reps converted to user's unit
2. Personal Records Card: Weight displayed in user's unit
3. Progress Chart Card: Y-axis labels in user's unit
4. Recent Workouts Card: No direct impact (count-based)

**Conversion Required**:
- Stored in backend: Always in kg (normalized)
- Display in UI: User's selected unit
- Convert on display, not on storage

**Source**: [Data Architecture (MVP), Feature Specifications]

### Testing Requirements

**Unit Tests** (Jest):
- Form validation logic
- Unit conversion functions
- Optimistic update behavior

**Integration Tests** (Testing Library + MSW):
- Profile form loading
- Edit and save flow
- Error handling and rollback
- Dashboard unit updates

**Test File Locations**:
- `__tests__/lib/utils/unit-conversion.test.ts`
- `__tests__/lib/mutations/update-profile.test.ts`
- `__tests__/components/profile/ProfileForm.test.tsx`
- `__tests__/pages/profile.test.tsx`

**Source**: [Testing Strategy - Unit Tests, Integration Tests]

## Testing

### Test Coverage Requirements
- Unit test coverage: > 85% for form and mutations
- Integration test coverage: Complete profile edit flow

### Test Scenarios
1. **Load Profile**: Navigate to /app/profile â†’ Form displays current values
2. **Edit Weight Unit**: Change kg â†’ lbs â†’ Save â†’ Success toast
3. **Edit Bodyweight**: Change value â†’ Save â†’ Updates profile
4. **Invalid Input**: Enter -50 â†’ Validation error shown
5. **Optimistic Update**: Edit field â†’ UI updates instantly (before API responds)
6. **Error Rollback**: Simulate API error â†’ UI reverts to previous values
7. **Dashboard Update**: Change unit â†’ Dashboard recalculates with new unit
8. **Cancel**: Make changes â†’ Click Cancel â†’ Form resets
9. **Analytics**: View and save â†’ Events fire correctly

### Performance Targets
- Page load: < 200ms
- Optimistic update: Instant (<5ms UI update)
- Save request: < 500ms
- Dashboard refresh: < 300ms

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Initial story creation with complete references | Bob (SM) |

## Dev Agent Record
*(To be populated by dev agent during implementation)*

### Agent Model Used
*(To be filled by dev agent)*

### Debug Log References
*(To be filled by dev agent)*

### Completion Notes List
*(To be filled by dev agent)*

### File List
*(To be filled by dev agent)*

## QA Results
*(To be populated by QA agent after dev completion)*



